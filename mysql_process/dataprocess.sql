SELECT date_dt,item_id,SUM(case when date_dt > date_dt_add(date_dt,1) and date_dt < date_dt_add(date_dt,14) then qty_alipay_njhs)AS label FROM (



drop table if exists cainiao.item_feature;
CREATE TABLE cainiao.item_feature( date_dt string, item_id string, cate_id string, cate_level_id string, brand_id string, supplier_id string, pv_ipv string, pv_uv string, cart_ipv string, cart_uv string, collect_uv string, num_gmv string, amt_gmv string, qty_gmv string, unum_gmv string, amt_alipay string, num_alipay string, qty_alipay string, unum_alipay string, ztc_pv_ipv string, tbk_pv_ipv string, ss_pv_ipv string, jhs_pv_ipv string, ztc_pv_uv string, tbk_pv_uv string, ss_pv_uv string, jhs_pv_uv string, num_alipay_njhs string, amt_alipay_njhs string, qty_alipay_njhs string, unum_alipay_njhs string ) 
ROW FORMAT DELIMITED
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n';



load data local inpath '/Users/hyy/Downloads/CAINIAO/item_feature2.csv' into table cainiao.item_feature;

--/*生成全亮笛卡尔积交叉表：*/
drop table if exists cainiao.date_dt_item;
create table cainiao.date_dt_item as 
select distinct date_dt,item_id,COALESCE(a.cate_id,0) cate_id,COALESCE(a.cate_level_id,0) cate_level_id,COALESCE(a.brand_id,0) brand_id,COALESCE(a.supplier_id,0) supplier_id,COALESCE(a.pv_ipv,0) pv_ipv,COALESCE(a.pv_uv,0) pv_uv,COALESCE(a.cart_ipv,0) cart_ipv,COALESCE(a.cart_uv,0) cart_uv,COALESCE(a.collect_uv,0) collect_uv,COALESCE(a.num_gmv,0) num_gmv,COALESCE(a.amt_gmv,0) amt_gmv,COALESCE(a.qty_gmv,0) qty_gmv,COALESCE(a.unum_gmv,0) unum_gmv,COALESCE(a.amt_alipay,0) amt_alipay,COALESCE(a.num_alipay,0) num_alipay,COALESCE(a.qty_alipay,0) qty_alipay,COALESCE(a.unum_alipay,0) unum_alipay,COALESCE(a.ztc_pv_ipv,0) ztc_pv_ipv,COALESCE(a.tbk_pv_ipv,0) tbk_pv_ipv,COALESCE(a.ss_pv_ipv,0) ss_pv_ipv,COALESCE(a.jhs_pv_ipv,0) jhs_pv_ipv,COALESCE(a.ztc_pv_uv,0) ztc_pv_uv,COALESCE(a.tbk_pv_uv,0) tbk_pv_uv,COALESCE(a.ss_pv_uv,0) ss_pv_uv,COALESCE(a.jhs_pv_uv,0) jhs_pv_uv,COALESCE(a.num_alipay_njhs,0) num_alipay_njhs,COALESCE(a.amt_alipay_njhs,0) amt_alipay_njhs,COALESCE(a.qty_alipay_njhs,0) qty_alipay_njhs,COALESCE(a.unum_alipay_njhs,0) unum_alipay_njhs
from
(select b.date_dt,b.item_id,COALESCE(a.cate_id,0) cate_id,COALESCE(a.cate_level_id,0) cate_level_id,COALESCE(a.brand_id,0) brand_id,COALESCE(a.supplier_id,0) supplier_id,COALESCE(a.pv_ipv,0) pv_ipv,COALESCE(a.pv_uv,0) pv_uv,COALESCE(a.cart_ipv,0) cart_ipv,COALESCE(a.cart_uv,0) cart_uv,COALESCE(a.collect_uv,0) collect_uv,COALESCE(a.num_gmv,0) num_gmv,COALESCE(a.amt_gmv,0) amt_gmv,COALESCE(a.qty_gmv,0) qty_gmv,COALESCE(a.unum_gmv,0) unum_gmv,COALESCE(a.amt_alipay,0) amt_alipay,COALESCE(a.num_alipay,0) num_alipay,COALESCE(a.qty_alipay,0) qty_alipay,COALESCE(a.unum_alipay,0) unum_alipay,COALESCE(a.ztc_pv_ipv,0) ztc_pv_ipv,COALESCE(a.tbk_pv_ipv,0) tbk_pv_ipv,COALESCE(a.ss_pv_ipv,0) ss_pv_ipv,COALESCE(a.jhs_pv_ipv,0) jhs_pv_ipv,COALESCE(a.ztc_pv_uv,0) ztc_pv_uv,COALESCE(a.tbk_pv_uv,0) tbk_pv_uv,COALESCE(a.ss_pv_uv,0) ss_pv_uv,COALESCE(a.jhs_pv_uv,0) jhs_pv_uv,COALESCE(a.num_alipay_njhs,0) num_alipay_njhs,COALESCE(a.amt_alipay_njhs,0) amt_alipay_njhs,COALESCE(a.qty_alipay_njhs,0) qty_alipay_njhs,COALESCE(a.unum_alipay_njhs,0) unum_alipay_njhs
  from
    (select a.date_dt,b.item_id
    from (select distinct date_dt from cainiao.item_feature) a 
    join (select distinct item_id from cainiao.item_feature
    ) b on 1=1
    group by a.date_dt,b.item_id
    )b 
  left join (select * from cainiao.item_feature) a on a.item_id = b.item_id and a.date_dt = b.date_dt
)a
;


--/*生成标签*/
select item_id,a.date_dt,sum(case when b.date_dt > date_dt_add(a.date_dt,1) and b.date_dt < date_dt_add(a.date_dt,14) then b.qty_alipay_njhs) AS label
from
(select item_id,date_dt,qty_alipay_njhs
from item_feature)a 
left join 
(select item_id,date_dt,qty_alipay_njhs) on a.item_id = b.item_id










--/*生成标签及特征*/
drop table if exists cainiao.date_item_feature1;
create table cainiao.date_item_feature1 as 
SELECT a.item_id,a.date_dt,COALESCE(sum(case when b.date_dt > date_add(a.date_dt,1) and b.date_dt < date_add(a.date_dt,14) then b.qty_alipay_njhs end),0) AS label,
COALESCE(a.cate_id,0) cate_id,COALESCE(a.cate_level_id,0) cate_level_id,COALESCE(a.brand_id,0) brand_id,COALESCE(a.supplier_id,0) supplier_id,COALESCE(a.pv_ipv,0) pv_ipv,COALESCE(a.pv_uv,0) pv_uv,COALESCE(a.cart_ipv,0) cart_ipv,COALESCE(a.cart_uv,0) cart_uv,COALESCE(a.collect_uv,0) collect_uv,COALESCE(a.num_gmv,0) num_gmv,COALESCE(a.amt_gmv,0) amt_gmv,COALESCE(a.qty_gmv,0) qty_gmv,COALESCE(a.unum_gmv,0) unum_gmv,COALESCE(a.amt_alipay,0) amt_alipay,COALESCE(a.num_alipay,0) num_alipay,COALESCE(a.qty_alipay,0) qty_alipay,COALESCE(a.unum_alipay,0) unum_alipay,COALESCE(a.ztc_pv_ipv,0) ztc_pv_ipv,COALESCE(a.tbk_pv_ipv,0) tbk_pv_ipv,COALESCE(a.ss_pv_ipv,0) ss_pv_ipv,COALESCE(a.jhs_pv_ipv,0) jhs_pv_ipv,COALESCE(a.ztc_pv_uv,0) ztc_pv_uv,COALESCE(a.tbk_pv_uv,0) tbk_pv_uv,COALESCE(a.ss_pv_uv,0) ss_pv_uv,COALESCE(a.jhs_pv_uv,0) jhs_pv_uv,COALESCE(a.num_alipay_njhs,0) num_alipay_njhs,COALESCE(a.amt_alipay_njhs,0) amt_alipay_njhs,COALESCE(a.qty_alipay_njhs,0) qty_alipay_njhs,COALESCE(a.unum_alipay_njhs,0) unum_alipay_njhs,
--/*组合特征*/
COALESCE(a.unum_alipay/a.pv_uv,0) deal_rate,COALESCE(a.num_alipay/a.num_gmv,0) success_deal,
COALESCE(a.amt_alipay/a.amt_gmv, 0) discount_rate,
COALESCE(a.amt_alipay/a.qty_alipay, 0) amt_qty_alipay,COALESCE(a.amt_alipay/a.num_alipay, 0) amt_num_alipay,
COALESCE(a.unum_alipay_njhs/a.pv_uv, 0) alipay_njhs_rate,COALESCE(a.qty_alipay_njhs/a.qty_alipay, 0) qty_njhs_rate ,COALESCE(a.amt_alipay_njhs/a.amt_gmv, 0) amt_njus_rate,COALESCE(a.amt_alipay_njhs/a.num_alipay_njhs, 0) njhs_price,
--/*时间影响因子*/
COALESCE(min(datediff('2015/12/28',a.date_dt)),0) min_date,COALESCE(max(datediff('2015/12/28',a.date_dt)),0) max_date_dt,(datediff('2015/12/28',a.date_dt)-1) as day_feature,
--/*窗口特征*/
--/*1*/
COALESCE(sum(case when b.date_dt = date_add(a.date_dt,1) then b.pv_ipv end ),0) as sum_pv_ipv1,COALESCE(sum(case when b.date_dt = date_add(a.date_dt,1) then b.pv_uv end ),0) as sum_pv_uv1,COALESCE(sum(case when b.date_dt = date_add(a.date_dt,1) then b.cart_ipv end ),0) as sum_cart_ipv1,COALESCE(sum(case when b.date_dt = date_add(a.date_dt,1) then b.cart_uv end ),0) as sum_cart_uv1,COALESCE(sum(case when b.date_dt = date_add(a.date_dt,1) then b.collect_uv end ),0) as sum_collect_uv1,COALESCE(sum(case when b.date_dt = date_add(a.date_dt,1) then b.num_gmv end ),0) as sum_num_gmv1,COALESCE(sum(case when b.date_dt = date_add(a.date_dt,1) then b.amt_gmv end ),0) as sum_amt_gmv1,COALESCE(sum(case when b.date_dt = date_add(a.date_dt,1) then b.qty_gmv end ),0) as sum_qty_gmv1,COALESCE(sum(case when b.date_dt = date_add(a.date_dt,1) then b.unum_gmv end ),0) as sum_unum_gmv1,COALESCE(sum(case when b.date_dt = date_add(a.date_dt,1) then b.amt_alipay end ),0) as sum_amt_alipay1,COALESCE(sum(case when b.date_dt = date_add(a.date_dt,1) then b.num_alipay end ),0) as sum_num_alipay1,COALESCE(sum(case when b.date_dt = date_add(a.date_dt,1) then b.qty_alipay end ),0) as sum_qty_alipay1,COALESCE(sum(case when b.date_dt = date_add(a.date_dt,1) then b.unum_alipay end ),0) as sum_unum_alipay1,COALESCE(sum(case when b.date_dt = date_add(a.date_dt,1) then b.ztc_pv_ipv end ),0) as sum_ztc_pv_ipv1,COALESCE(sum(case when b.date_dt = date_add(a.date_dt,1) then b.tbk_pv_ipv end ),0) as sum_tbk_pv_ipv1,COALESCE(sum(case when b.date_dt = date_add(a.date_dt,1) then b.ss_pv_ipv end ),0) as sum_ss_pv_ipv1,COALESCE(sum(case when b.date_dt = date_add(a.date_dt,1) then b.jhs_pv_ipv end ),0) as sum_jhs_pv_ipv1,COALESCE(sum(case when b.date_dt = date_add(a.date_dt,1) then b.ztc_pv_uv end ),0) as sum_ztc_pv_uv1,COALESCE(sum(case when b.date_dt = date_add(a.date_dt,1) then b.tbk_pv_uv end ),0) as sum_tbk_pv_uv1,COALESCE(sum(case when b.date_dt = date_add(a.date_dt,1) then b.ss_pv_uv end ),0) as sum_ss_pv_uv1,COALESCE(sum(case when b.date_dt = date_add(a.date_dt,1) then b.jhs_pv_uv end ),0) as sum_jhs_pv_uv1,COALESCE(sum(case when b.date_dt = date_add(a.date_dt,1) then b.num_alipay_njhs end ),0) as sum_num_alipay_njhs1,COALESCE(sum(case when b.date_dt = date_add(a.date_dt,1) then b.amt_alipay_njhs end ),0) as sum_amt_alipay_njhs1,COALESCE(sum(case when b.date_dt = date_add(a.date_dt,1) then b.qty_alipay_njhs end ),0) as sum_qty_alipay_njhs1,COALESCE(sum(case when b.date_dt = date_add(a.date_dt,1) then b.unum_alipay_njhs end ),0) as sum_unum_alipay_njhs1,
COALESCE(avg(case when b.date_dt = date_add(a.date_dt,1) then b.pv_ipv end ),0) as avg_pv_ipv1,COALESCE(avg(case when b.date_dt = date_add(a.date_dt,1) then b.pv_uv end ),0) as avg_pv_uv1,COALESCE(avg(case when b.date_dt = date_add(a.date_dt,1) then b.cart_ipv end ),0) as avg_cart_ipv1,COALESCE(avg(case when b.date_dt = date_add(a.date_dt,1) then b.cart_uv end ),0) as avg_cart_uv1,COALESCE(avg(case when b.date_dt = date_add(a.date_dt,1) then b.collect_uv end ),0) as avg_collect_uv1,COALESCE(avg(case when b.date_dt = date_add(a.date_dt,1) then b.num_gmv end ),0) as avg_num_gmv1,COALESCE(avg(case when b.date_dt = date_add(a.date_dt,1) then b.amt_gmv end ),0) as avg_amt_gmv1,COALESCE(avg(case when b.date_dt = date_add(a.date_dt,1) then b.qty_gmv end ),0) as avg_qty_gmv1,COALESCE(avg(case when b.date_dt = date_add(a.date_dt,1) then b.unum_gmv end ),0) as avg_unum_gmv1,COALESCE(avg(case when b.date_dt = date_add(a.date_dt,1) then b.amt_alipay end ),0) as avg_amt_alipay1,COALESCE(avg(case when b.date_dt = date_add(a.date_dt,1) then b.num_alipay end ),0) as avg_num_alipay1,COALESCE(avg(case when b.date_dt = date_add(a.date_dt,1) then b.qty_alipay end ),0) as avg_qty_alipay1,COALESCE(avg(case when b.date_dt = date_add(a.date_dt,1) then b.unum_alipay end ),0) as avg_unum_alipay1,COALESCE(avg(case when b.date_dt = date_add(a.date_dt,1) then b.ztc_pv_ipv end ),0) as avg_ztc_pv_ipv1,COALESCE(avg(case when b.date_dt = date_add(a.date_dt,1) then b.tbk_pv_ipv end ),0) as avg_tbk_pv_ipv1,COALESCE(avg(case when b.date_dt = date_add(a.date_dt,1) then b.ss_pv_ipv end ),0) as avg_ss_pv_ipv1,COALESCE(avg(case when b.date_dt = date_add(a.date_dt,1) then b.jhs_pv_ipv end ),0) as avg_jhs_pv_ipv1,COALESCE(avg(case when b.date_dt = date_add(a.date_dt,1) then b.ztc_pv_uv end ),0) as avg_ztc_pv_uv1,COALESCE(avg(case when b.date_dt = date_add(a.date_dt,1) then b.tbk_pv_uv end ),0) as avg_tbk_pv_uv1,COALESCE(avg(case when b.date_dt = date_add(a.date_dt,1) then b.ss_pv_uv end ),0) as avg_ss_pv_uv1,COALESCE(avg(case when b.date_dt = date_add(a.date_dt,1) then b.jhs_pv_uv end ),0) as avg_jhs_pv_uv1,COALESCE(avg(case when b.date_dt = date_add(a.date_dt,1) then b.num_alipay_njhs end ),0) as avg_num_alipay_njhs1,COALESCE(avg(case when b.date_dt = date_add(a.date_dt,1) then b.amt_alipay_njhs end ),0) as avg_amt_alipay_njhs1,COALESCE(avg(case when b.date_dt = date_add(a.date_dt,1) then b.qty_alipay_njhs end ),0) as avg_qty_alipay_njhs1,COALESCE(avg(case when b.date_dt = date_add(a.date_dt,1) then b.unum_alipay_njhs end ),0) as avg_unum_alipay_njhs1,
COALESCE(stddev(case when b.date_dt = date_add(a.date_dt,1) then b.pv_ipv end ),0) as stddev_pv_uv1,COALESCE(stddev(case when b.date_dt = date_add(a.date_dt,1) then b.pv_uv end ),0) as stddev_cart_ipv1,COALESCE(stddev(case when b.date_dt = date_add(a.date_dt,1) then b.cart_ipv end ),0) as stddev_cart_uv1,COALESCE(stddev(case when b.date_dt = date_add(a.date_dt,1) then b.cart_uv end ),0) as stddev_collect_uv1,COALESCE(stddev(case when b.date_dt = date_add(a.date_dt,1) then b.collect_uv end ),0) as stddev_num_gmv1,COALESCE(stddev(case when b.date_dt = date_add(a.date_dt,1) then b.num_gmv end ),0) as stddev_amt_gmv1,COALESCE(stddev(case when b.date_dt = date_add(a.date_dt,1) then b.amt_gmv end ),0) as stddev_qty_gmv1,COALESCE(stddev(case when b.date_dt = date_add(a.date_dt,1) then b.qty_gmv end ),0) as stddev_unum_gmv1,COALESCE(stddev(case when b.date_dt = date_add(a.date_dt,1) then b.unum_gmv end ),0) as stddev_amt_alipay1,COALESCE(stddev(case when b.date_dt = date_add(a.date_dt,1) then b.amt_alipay end ),0) as stddev_num_alipay1,COALESCE(stddev(case when b.date_dt = date_add(a.date_dt,1) then b.num_alipay end ),0) as stddev_qty_alipay1,COALESCE(stddev(case when b.date_dt = date_add(a.date_dt,1) then b.qty_alipay end ),0) as stddev_unum_alipay1,COALESCE(stddev(case when b.date_dt = date_add(a.date_dt,1) then b.unum_alipay end ),0) as stddev_ztc_pv_ipv1,COALESCE(stddev(case when b.date_dt = date_add(a.date_dt,1) then b.ztc_pv_ipv end ),0) as stddev_tbk_pv_ipv1,COALESCE(stddev(case when b.date_dt = date_add(a.date_dt,1) then b.tbk_pv_ipv end ),0) as stddev_ss_pv_ipv1,COALESCE(stddev(case when b.date_dt = date_add(a.date_dt,1) then b.ss_pv_ipv end ),0) as stddev_jhs_pv_ipv1,COALESCE(stddev(case when b.date_dt = date_add(a.date_dt,1) then b.jhs_pv_ipv end ),0) as stddev_ztc_pv_uv1,COALESCE(stddev(case when b.date_dt = date_add(a.date_dt,1) then b.ztc_pv_uv end ),0) as stddev_tbk_pv_uv1,COALESCE(stddev(case when b.date_dt = date_add(a.date_dt,1) then b.tbk_pv_uv end ),0) as stddev_ss_pv_uv1,COALESCE(stddev(case when b.date_dt = date_add(a.date_dt,1) then b.ss_pv_uv end ),0) as stddev_jhs_pv_uv1,COALESCE(stddev(case when b.date_dt = date_add(a.date_dt,1) then b.jhs_pv_uv end ),0) as stddev_num_alipay_njhs1,COALESCE(stddev(case when b.date_dt = date_add(a.date_dt,1) then b.num_alipay_njhs end ),0) as stddev_amt_alipay_njhs1,COALESCE(stddev(case when b.date_dt = date_add(a.date_dt,1) then b.amt_alipay_njhs end ),0) as stddev_qty_alipay_njhs1,COALESCE(stddev(case when b.date_dt = date_add(a.date_dt,1) then b.qty_alipay_njhs end ),0) as stddev_unum_alipay_njhs1,
--/*2*/
COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.pv_ipv end ),0) as sum_pv_ipv2,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.pv_uv end ),0) as sum_pv_uv2,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.cart_ipv end ),0) as sum_cart_ipv2,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.cart_uv end ),0) as sum_cart_uv2,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.collect_uv end ),0) as sum_collect_uv2,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.num_gmv end ),0) as sum_num_gmv2,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.amt_gmv end ),0) as sum_amt_gmv2,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.qty_gmv end ),0) as sum_qty_gmv2,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.unum_gmv end ),0) as sum_unum_gmv2,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.amt_alipay end ),0) as sum_amt_alipay2,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.num_alipay end ),0) as sum_num_alipay2,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.qty_alipay end ),0) as sum_qty_alipay2,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.unum_alipay end ),0) as sum_unum_alipay2,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.ztc_pv_ipv end ),0) as sum_ztc_pv_ipv2,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.tbk_pv_ipv end ),0) as sum_tbk_pv_ipv2,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.ss_pv_ipv end ),0) as sum_ss_pv_ipv2,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.jhs_pv_ipv end ),0) as sum_jhs_pv_ipv2,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.ztc_pv_uv end ),0) as sum_ztc_pv_uv2,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.tbk_pv_uv end ),0) as sum_tbk_pv_uv2,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.ss_pv_uv end ),0) as sum_ss_pv_uv2,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.jhs_pv_uv end ),0) as sum_jhs_pv_uv2,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.num_alipay_njhs end ),0) as sum_num_alipay_njhs2,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.amt_alipay_njhs end ),0) as sum_amt_alipay_njhs2,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.qty_alipay_njhs end ),0) as sum_qty_alipay_njhs2,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.unum_alipay_njhs end ),0) as sum_unum_alipay_njhs2,
COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.pv_ipv end ),0) as avg_pv_ipv2,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.pv_uv end ),0) as avg_pv_uv2,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.cart_ipv end ),0) as avg_cart_ipv2,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.cart_uv end ),0) as avg_cart_uv2,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.collect_uv end ),0) as avg_collect_uv2,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.num_gmv end ),0) as avg_num_gmv2,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.amt_gmv end ),0) as avg_amt_gmv2,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.qty_gmv end ),0) as avg_qty_gmv2,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.unum_gmv end ),0) as avg_unum_gmv2,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.amt_alipay end ),0) as avg_amt_alipay2,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.num_alipay end ),0) as avg_num_alipay2,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.qty_alipay end ),0) as avg_qty_alipay2,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.unum_alipay end ),0) as avg_unum_alipay2,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.ztc_pv_ipv end ),0) as avg_ztc_pv_ipv2,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.tbk_pv_ipv end ),0) as avg_tbk_pv_ipv2,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.ss_pv_ipv end ),0) as avg_ss_pv_ipv2,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.jhs_pv_ipv end ),0) as avg_jhs_pv_ipv2,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.ztc_pv_uv end ),0) as avg_ztc_pv_uv2,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.tbk_pv_uv end ),0) as avg_tbk_pv_uv2,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.ss_pv_uv end ),0) as avg_ss_pv_uv2,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.jhs_pv_uv end ),0) as avg_jhs_pv_uv2,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.num_alipay_njhs end ),0) as avg_num_alipay_njhs2,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.amt_alipay_njhs end ),0) as avg_amt_alipay_njhs2,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.qty_alipay_njhs end ),0) as avg_qty_alipay_njhs2,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.unum_alipay_njhs end ),0) as avg_unum_alipay_njhs2,
COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.pv_ipv end ),0) as stddev_pv_uv2,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.pv_uv end ),0) as stddev_cart_ipv2,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.cart_ipv end ),0) as stddev_cart_uv2,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.cart_uv end ),0) as stddev_collect_uv2,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.collect_uv end ),0) as stddev_num_gmv2,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.num_gmv end ),0) as stddev_amt_gmv2,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.amt_gmv end ),0) as stddev_qty_gmv2,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.qty_gmv end ),0) as stddev_unum_gmv2,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.unum_gmv end ),0) as stddev_amt_alipay2,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.amt_alipay end ),0) as stddev_num_alipay2,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.num_alipay end ),0) as stddev_qty_alipay2,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.qty_alipay end ),0) as stddev_unum_alipay2,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.unum_alipay end ),0) as stddev_ztc_pv_ipv2,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.ztc_pv_ipv end ),0) as stddev_tbk_pv_ipv2,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.tbk_pv_ipv end ),0) as stddev_ss_pv_ipv2,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.ss_pv_ipv end ),0) as stddev_jhs_pv_ipv2,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.jhs_pv_ipv end ),0) as stddev_ztc_pv_uv2,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.ztc_pv_uv end ),0) as stddev_tbk_pv_uv2,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.tbk_pv_uv end ),0) as stddev_ss_pv_uv2,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.ss_pv_uv end ),0) as stddev_jhs_pv_uv2,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.jhs_pv_uv end ),0) as stddev_num_alipay_njhs2,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.num_alipay_njhs end ),0) as stddev_amt_alipay_njhs2,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.amt_alipay_njhs end ),0) as stddev_qty_alipay_njhs2,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,2) then b.qty_alipay_njhs end ),0) as stddev_unum_alipay_njhs2,
--/*3*/
COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.pv_ipv end ),0) as sum_pv_ipv3,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.pv_uv end ),0) as sum_pv_uv3,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.cart_ipv end ),0) as sum_cart_ipv3,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.cart_uv end ),0) as sum_cart_uv3,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.collect_uv end ),0) as sum_collect_uv3,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.num_gmv end ),0) as sum_num_gmv3,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.amt_gmv end ),0) as sum_amt_gmv3,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.qty_gmv end ),0) as sum_qty_gmv3,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.unum_gmv end ),0) as sum_unum_gmv3,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.amt_alipay end ),0) as sum_amt_alipay3,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.num_alipay end ),0) as sum_num_alipay3,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.qty_alipay end ),0) as sum_qty_alipay3,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.unum_alipay end ),0) as sum_unum_alipay3,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.ztc_pv_ipv end ),0) as sum_ztc_pv_ipv3,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.tbk_pv_ipv end ),0) as sum_tbk_pv_ipv3,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.ss_pv_ipv end ),0) as sum_ss_pv_ipv3,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.jhs_pv_ipv end ),0) as sum_jhs_pv_ipv3,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.ztc_pv_uv end ),0) as sum_ztc_pv_uv3,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.tbk_pv_uv end ),0) as sum_tbk_pv_uv3,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.ss_pv_uv end ),0) as sum_ss_pv_uv3,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.jhs_pv_uv end ),0) as sum_jhs_pv_uv3,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.num_alipay_njhs end ),0) as sum_num_alipay_njhs3,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.amt_alipay_njhs end ),0) as sum_amt_alipay_njhs3,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.qty_alipay_njhs end ),0) as sum_qty_alipay_njhs3,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.unum_alipay_njhs end ),0) as sum_unum_alipay_njhs3,
COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.pv_ipv end ),0) as avg_pv_ipv3,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.pv_uv end ),0) as avg_pv_uv3,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.cart_ipv end ),0) as avg_cart_ipv3,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.cart_uv end ),0) as avg_cart_uv3,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.collect_uv end ),0) as avg_collect_uv3,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.num_gmv end ),0) as avg_num_gmv3,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.amt_gmv end ),0) as avg_amt_gmv3,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.qty_gmv end ),0) as avg_qty_gmv3,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.unum_gmv end ),0) as avg_unum_gmv3,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.amt_alipay end ),0) as avg_amt_alipay3,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.num_alipay end ),0) as avg_num_alipay3,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.qty_alipay end ),0) as avg_qty_alipay3,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.unum_alipay end ),0) as avg_unum_alipay3,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.ztc_pv_ipv end ),0) as avg_ztc_pv_ipv3,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.tbk_pv_ipv end ),0) as avg_tbk_pv_ipv3,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.ss_pv_ipv end ),0) as avg_ss_pv_ipv3,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.jhs_pv_ipv end ),0) as avg_jhs_pv_ipv3,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.ztc_pv_uv end ),0) as avg_ztc_pv_uv3,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.tbk_pv_uv end ),0) as avg_tbk_pv_uv3,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.ss_pv_uv end ),0) as avg_ss_pv_uv3,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.jhs_pv_uv end ),0) as avg_jhs_pv_uv3,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.num_alipay_njhs end ),0) as avg_num_alipay_njhs3,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.amt_alipay_njhs end ),0) as avg_amt_alipay_njhs3,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.qty_alipay_njhs end ),0) as avg_qty_alipay_njhs3,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.unum_alipay_njhs end ),0) as avg_unum_alipay_njhs3,
COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.pv_ipv end ),0) as stddev_pv_uv3,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.pv_uv end ),0) as stddev_cart_ipv3,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.cart_ipv end ),0) as stddev_cart_uv3,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.cart_uv end ),0) as stddev_collect_uv3,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.collect_uv end ),0) as stddev_num_gmv3,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.num_gmv end ),0) as stddev_amt_gmv3,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.amt_gmv end ),0) as stddev_qty_gmv3,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.qty_gmv end ),0) as stddev_unum_gmv3,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.unum_gmv end ),0) as stddev_amt_alipay3,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.amt_alipay end ),0) as stddev_num_alipay3,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.num_alipay end ),0) as stddev_qty_alipay3,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.qty_alipay end ),0) as stddev_unum_alipay3,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.unum_alipay end ),0) as stddev_ztc_pv_ipv3,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.ztc_pv_ipv end ),0) as stddev_tbk_pv_ipv3,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.tbk_pv_ipv end ),0) as stddev_ss_pv_ipv3,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.ss_pv_ipv end ),0) as stddev_jhs_pv_ipv3,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.jhs_pv_ipv end ),0) as stddev_ztc_pv_uv3,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.ztc_pv_uv end ),0) as stddev_tbk_pv_uv3,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.tbk_pv_uv end ),0) as stddev_ss_pv_uv3,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.ss_pv_uv end ),0) as stddev_jhs_pv_uv3,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.jhs_pv_uv end ),0) as stddev_num_alipay_njhs3,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.num_alipay_njhs end ),0) as stddev_amt_alipay_njhs3,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.amt_alipay_njhs end ),0) as stddev_qty_alipay_njhs3,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,3) then b.qty_alipay_njhs end ),0) as stddev_unum_alipay_njhs3,
--/*4*/
COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.pv_ipv end ),0) as sum_pv_ipv4,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.pv_uv end ),0) as sum_pv_uv4,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.cart_ipv end ),0) as sum_cart_ipv4,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.cart_uv end ),0) as sum_cart_uv4,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.collect_uv end ),0) as sum_collect_uv4,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.num_gmv end ),0) as sum_num_gmv4,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.amt_gmv end ),0) as sum_amt_gmv4,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.qty_gmv end ),0) as sum_qty_gmv4,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.unum_gmv end ),0) as sum_unum_gmv4,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.amt_alipay end ),0) as sum_amt_alipay4,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.num_alipay end ),0) as sum_num_alipay4,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.qty_alipay end ),0) as sum_qty_alipay4,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.unum_alipay end ),0) as sum_unum_alipay4,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.ztc_pv_ipv end ),0) as sum_ztc_pv_ipv4,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.tbk_pv_ipv end ),0) as sum_tbk_pv_ipv4,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.ss_pv_ipv end ),0) as sum_ss_pv_ipv4,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.jhs_pv_ipv end ),0) as sum_jhs_pv_ipv4,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.ztc_pv_uv end ),0) as sum_ztc_pv_uv4,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.tbk_pv_uv end ),0) as sum_tbk_pv_uv4,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.ss_pv_uv end ),0) as sum_ss_pv_uv4,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.jhs_pv_uv end ),0) as sum_jhs_pv_uv4,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.num_alipay_njhs end ),0) as sum_num_alipay_njhs4,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.amt_alipay_njhs end ),0) as sum_amt_alipay_njhs4,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.qty_alipay_njhs end ),0) as sum_qty_alipay_njhs4,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.unum_alipay_njhs end ),0) as sum_unum_alipay_njhs4,
COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.pv_ipv end ),0) as avg_pv_ipv4,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.pv_uv end ),0) as avg_pv_uv4,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.cart_ipv end ),0) as avg_cart_ipv4,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.cart_uv end ),0) as avg_cart_uv4,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.collect_uv end ),0) as avg_collect_uv4,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.num_gmv end ),0) as avg_num_gmv4,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.amt_gmv end ),0) as avg_amt_gmv4,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.qty_gmv end ),0) as avg_qty_gmv4,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.unum_gmv end ),0) as avg_unum_gmv4,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.amt_alipay end ),0) as avg_amt_alipay4,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.num_alipay end ),0) as avg_num_alipay4,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.qty_alipay end ),0) as avg_qty_alipay4,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.unum_alipay end ),0) as avg_unum_alipay4,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.ztc_pv_ipv end ),0) as avg_ztc_pv_ipv4,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.tbk_pv_ipv end ),0) as avg_tbk_pv_ipv4,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.ss_pv_ipv end ),0) as avg_ss_pv_ipv4,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.jhs_pv_ipv end ),0) as avg_jhs_pv_ipv4,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.ztc_pv_uv end ),0) as avg_ztc_pv_uv4,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.tbk_pv_uv end ),0) as avg_tbk_pv_uv4,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.ss_pv_uv end ),0) as avg_ss_pv_uv4,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.jhs_pv_uv end ),0) as avg_jhs_pv_uv4,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.num_alipay_njhs end ),0) as avg_num_alipay_njhs4,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.amt_alipay_njhs end ),0) as avg_amt_alipay_njhs4,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.qty_alipay_njhs end ),0) as avg_qty_alipay_njhs4,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.unum_alipay_njhs end ),0) as avg_unum_alipay_njhs4,
COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.pv_ipv end ),0) as stddev_pv_uv4,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.pv_uv end ),0) as stddev_cart_ipv4,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.cart_ipv end ),0) as stddev_cart_uv4,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.cart_uv end ),0) as stddev_collect_uv4,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.collect_uv end ),0) as stddev_num_gmv4,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.num_gmv end ),0) as stddev_amt_gmv4,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.amt_gmv end ),0) as stddev_qty_gmv4,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.qty_gmv end ),0) as stddev_unum_gmv4,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.unum_gmv end ),0) as stddev_amt_alipay4,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.amt_alipay end ),0) as stddev_num_alipay4,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.num_alipay end ),0) as stddev_qty_alipay4,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.qty_alipay end ),0) as stddev_unum_alipay4,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.unum_alipay end ),0) as stddev_ztc_pv_ipv4,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.ztc_pv_ipv end ),0) as stddev_tbk_pv_ipv4,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.tbk_pv_ipv end ),0) as stddev_ss_pv_ipv4,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.ss_pv_ipv end ),0) as stddev_jhs_pv_ipv4,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.jhs_pv_ipv end ),0) as stddev_ztc_pv_uv4,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.ztc_pv_uv end ),0) as stddev_tbk_pv_uv4,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.tbk_pv_uv end ),0) as stddev_ss_pv_uv4,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.ss_pv_uv end ),0) as stddev_jhs_pv_uv4,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.jhs_pv_uv end ),0) as stddev_num_alipay_njhs4,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.num_alipay_njhs end ),0) as stddev_amt_alipay_njhs4,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.amt_alipay_njhs end ),0) as stddev_qty_alipay_njhs4,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,4) then b.qty_alipay_njhs end ),0) as stddev_unum_alipay_njhs4,
--/*7*/
COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.pv_ipv end ),0) as sum_pv_ipv7,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.pv_uv end ),0) as sum_pv_uv7,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.cart_ipv end ),0) as sum_cart_ipv7,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.cart_uv end ),0) as sum_cart_uv7,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.collect_uv end ),0) as sum_collect_uv7,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.num_gmv end ),0) as sum_num_gmv7,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.amt_gmv end ),0) as sum_amt_gmv7,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.qty_gmv end ),0) as sum_qty_gmv7,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.unum_gmv end ),0) as sum_unum_gmv7,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.amt_alipay end ),0) as sum_amt_alipay7,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.num_alipay end ),0) as sum_num_alipay7,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.qty_alipay end ),0) as sum_qty_alipay7,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.unum_alipay end ),0) as sum_unum_alipay7,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.ztc_pv_ipv end ),0) as sum_ztc_pv_ipv7,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.tbk_pv_ipv end ),0) as sum_tbk_pv_ipv7,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.ss_pv_ipv end ),0) as sum_ss_pv_ipv7,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.jhs_pv_ipv end ),0) as sum_jhs_pv_ipv7,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.ztc_pv_uv end ),0) as sum_ztc_pv_uv7,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.tbk_pv_uv end ),0) as sum_tbk_pv_uv7,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.ss_pv_uv end ),0) as sum_ss_pv_uv7,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.jhs_pv_uv end ),0) as sum_jhs_pv_uv7,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.num_alipay_njhs end ),0) as sum_num_alipay_njhs7,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.amt_alipay_njhs end ),0) as sum_amt_alipay_njhs7,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.qty_alipay_njhs end ),0) as sum_qty_alipay_njhs7,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.unum_alipay_njhs end ),0) as sum_unum_alipay_njhs7,
COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.pv_ipv end ),0) as avg_pv_ipv7,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.pv_uv end ),0) as avg_pv_uv7,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.cart_ipv end ),0) as avg_cart_ipv7,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.cart_uv end ),0) as avg_cart_uv7,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.collect_uv end ),0) as avg_collect_uv7,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.num_gmv end ),0) as avg_num_gmv7,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.amt_gmv end ),0) as avg_amt_gmv7,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.qty_gmv end ),0) as avg_qty_gmv7,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.unum_gmv end ),0) as avg_unum_gmv7,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.amt_alipay end ),0) as avg_amt_alipay7,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.num_alipay end ),0) as avg_num_alipay7,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.qty_alipay end ),0) as avg_qty_alipay7,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.unum_alipay end ),0) as avg_unum_alipay7,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.ztc_pv_ipv end ),0) as avg_ztc_pv_ipv7,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.tbk_pv_ipv end ),0) as avg_tbk_pv_ipv7,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.ss_pv_ipv end ),0) as avg_ss_pv_ipv7,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.jhs_pv_ipv end ),0) as avg_jhs_pv_ipv7,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.ztc_pv_uv end ),0) as avg_ztc_pv_uv7,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.tbk_pv_uv end ),0) as avg_tbk_pv_uv7,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.ss_pv_uv end ),0) as avg_ss_pv_uv7,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.jhs_pv_uv end ),0) as avg_jhs_pv_uv7,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.num_alipay_njhs end ),0) as avg_num_alipay_njhs7,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.amt_alipay_njhs end ),0) as avg_amt_alipay_njhs7,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.qty_alipay_njhs end ),0) as avg_qty_alipay_njhs7,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.unum_alipay_njhs end ),0) as avg_unum_alipay_njhs7,
COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.pv_ipv end ),0) as stddev_pv_uv7,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.pv_uv end ),0) as stddev_cart_ipv7,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.cart_ipv end ),0) as stddev_cart_uv7,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.cart_uv end ),0) as stddev_collect_uv7,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.collect_uv end ),0) as stddev_num_gmv7,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.num_gmv end ),0) as stddev_amt_gmv7,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.amt_gmv end ),0) as stddev_qty_gmv7,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.qty_gmv end ),0) as stddev_unum_gmv7,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.unum_gmv end ),0) as stddev_amt_alipay7,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.amt_alipay end ),0) as stddev_num_alipay7,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.num_alipay end ),0) as stddev_qty_alipay7,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.qty_alipay end ),0) as stddev_unum_alipay7,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.unum_alipay end ),0) as stddev_ztc_pv_ipv7,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.ztc_pv_ipv end ),0) as stddev_tbk_pv_ipv7,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.tbk_pv_ipv end ),0) as stddev_ss_pv_ipv7,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.ss_pv_ipv end ),0) as stddev_jhs_pv_ipv7,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.jhs_pv_ipv end ),0) as stddev_ztc_pv_uv7,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.ztc_pv_uv end ),0) as stddev_tbk_pv_uv7,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.tbk_pv_uv end ),0) as stddev_ss_pv_uv7,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.ss_pv_uv end ),0) as stddev_jhs_pv_uv7,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.jhs_pv_uv end ),0) as stddev_num_alipay_njhs7,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.num_alipay_njhs end ),0) as stddev_amt_alipay_njhs7,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.amt_alipay_njhs end ),0) as stddev_qty_alipay_njhs7,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,7) then b.qty_alipay_njhs end ),0) as stddev_unum_alipay_njhs7,
--/*14*/
COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.pv_ipv end ),0) as sum_pv_ipv14,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.pv_uv end ),0) as sum_pv_uv14,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.cart_ipv end ),0) as sum_cart_ipv14,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.cart_uv end ),0) as sum_cart_uv14,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.collect_uv end ),0) as sum_collect_uv14,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.num_gmv end ),0) as sum_num_gmv14,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.amt_gmv end ),0) as sum_amt_gmv14,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.qty_gmv end ),0) as sum_qty_gmv14,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.unum_gmv end ),0) as sum_unum_gmv14,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.amt_alipay end ),0) as sum_amt_alipay14,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.num_alipay end ),0) as sum_num_alipay14,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.qty_alipay end ),0) as sum_qty_alipay14,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.unum_alipay end ),0) as sum_unum_alipay14,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.ztc_pv_ipv end ),0) as sum_ztc_pv_ipv14,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.tbk_pv_ipv end ),0) as sum_tbk_pv_ipv14,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.ss_pv_ipv end ),0) as sum_ss_pv_ipv14,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.jhs_pv_ipv end ),0) as sum_jhs_pv_ipv14,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.ztc_pv_uv end ),0) as sum_ztc_pv_uv14,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.tbk_pv_uv end ),0) as sum_tbk_pv_uv14,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.ss_pv_uv end ),0) as sum_ss_pv_uv14,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.jhs_pv_uv end ),0) as sum_jhs_pv_uv14,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.num_alipay_njhs end ),0) as sum_num_alipay_njhs14,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.amt_alipay_njhs end ),0) as sum_amt_alipay_njhs14,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.qty_alipay_njhs end ),0) as sum_qty_alipay_njhs14,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.unum_alipay_njhs end ),0) as sum_unum_alipay_njhs14,
COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.pv_ipv end ),0) as avg_pv_ipv14,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.pv_uv end ),0) as avg_pv_uv14,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.cart_ipv end ),0) as avg_cart_ipv14,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.cart_uv end ),0) as avg_cart_uv14,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.collect_uv end ),0) as avg_collect_uv14,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.num_gmv end ),0) as avg_num_gmv14,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.amt_gmv end ),0) as avg_amt_gmv14,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.qty_gmv end ),0) as avg_qty_gmv14,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.unum_gmv end ),0) as avg_unum_gmv14,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.amt_alipay end ),0) as avg_amt_alipay14,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.num_alipay end ),0) as avg_num_alipay14,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.qty_alipay end ),0) as avg_qty_alipay14,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.unum_alipay end ),0) as avg_unum_alipay14,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.ztc_pv_ipv end ),0) as avg_ztc_pv_ipv14,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.tbk_pv_ipv end ),0) as avg_tbk_pv_ipv14,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.ss_pv_ipv end ),0) as avg_ss_pv_ipv14,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.jhs_pv_ipv end ),0) as avg_jhs_pv_ipv14,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.ztc_pv_uv end ),0) as avg_ztc_pv_uv14,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.tbk_pv_uv end ),0) as avg_tbk_pv_uv14,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.ss_pv_uv end ),0) as avg_ss_pv_uv14,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.jhs_pv_uv end ),0) as avg_jhs_pv_uv14,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.num_alipay_njhs end ),0) as avg_num_alipay_njhs14,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.amt_alipay_njhs end ),0) as avg_amt_alipay_njhs14,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.qty_alipay_njhs end ),0) as avg_qty_alipay_njhs14,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.unum_alipay_njhs end ),0) as avg_unum_alipay_njhs14,
COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.pv_ipv end ),0) as stddev_pv_uv14,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.pv_uv end ),0) as stddev_cart_ipv14,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.cart_ipv end ),0) as stddev_cart_uv14,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.cart_uv end ),0) as stddev_collect_uv14,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.collect_uv end ),0) as stddev_num_gmv14,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.num_gmv end ),0) as stddev_amt_gmv14,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.amt_gmv end ),0) as stddev_qty_gmv14,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.qty_gmv end ),0) as stddev_unum_gmv14,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.unum_gmv end ),0) as stddev_amt_alipay14,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.amt_alipay end ),0) as stddev_num_alipay14,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.num_alipay end ),0) as stddev_qty_alipay14,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.qty_alipay end ),0) as stddev_unum_alipay14,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.unum_alipay end ),0) as stddev_ztc_pv_ipv14,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.ztc_pv_ipv end ),0) as stddev_tbk_pv_ipv14,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.tbk_pv_ipv end ),0) as stddev_ss_pv_ipv14,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.ss_pv_ipv end ),0) as stddev_jhs_pv_ipv14,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.jhs_pv_ipv end ),0) as stddev_ztc_pv_uv14,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.ztc_pv_uv end ),0) as stddev_tbk_pv_uv14,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.tbk_pv_uv end ),0) as stddev_ss_pv_uv14,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.ss_pv_uv end ),0) as stddev_jhs_pv_uv14,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.jhs_pv_uv end ),0) as stddev_num_alipay_njhs14,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.num_alipay_njhs end ),0) as stddev_amt_alipay_njhs14,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.amt_alipay_njhs end ),0) as stddev_qty_alipay_njhs14,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,14) then b.qty_alipay_njhs end ),0) as stddev_unum_alipay_njhs14,
--/*21*/
COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.pv_ipv end ),0) as sum_pv_ipv21,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.pv_uv end ),0) as sum_pv_uv21,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.cart_ipv end ),0) as sum_cart_ipv21,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.cart_uv end ),0) as sum_cart_uv21,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.collect_uv end ),0) as sum_collect_uv21,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.num_gmv end ),0) as sum_num_gmv21,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.amt_gmv end ),0) as sum_amt_gmv21,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.qty_gmv end ),0) as sum_qty_gmv21,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.unum_gmv end ),0) as sum_unum_gmv21,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.amt_alipay end ),0) as sum_amt_alipay21,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.num_alipay end ),0) as sum_num_alipay21,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.qty_alipay end ),0) as sum_qty_alipay21,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.unum_alipay end ),0) as sum_unum_alipay21,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.ztc_pv_ipv end ),0) as sum_ztc_pv_ipv21,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.tbk_pv_ipv end ),0) as sum_tbk_pv_ipv21,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.ss_pv_ipv end ),0) as sum_ss_pv_ipv21,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.jhs_pv_ipv end ),0) as sum_jhs_pv_ipv21,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.ztc_pv_uv end ),0) as sum_ztc_pv_uv21,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.tbk_pv_uv end ),0) as sum_tbk_pv_uv21,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.ss_pv_uv end ),0) as sum_ss_pv_uv21,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.jhs_pv_uv end ),0) as sum_jhs_pv_uv21,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.num_alipay_njhs end ),0) as sum_num_alipay_njhs21,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.amt_alipay_njhs end ),0) as sum_amt_alipay_njhs21,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.qty_alipay_njhs end ),0) as sum_qty_alipay_njhs21,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.unum_alipay_njhs end ),0) as sum_unum_alipay_njhs21,
COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.pv_ipv end ),0) as avg_pv_ipv21,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.pv_uv end ),0) as avg_pv_uv21,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.cart_ipv end ),0) as avg_cart_ipv21,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.cart_uv end ),0) as avg_cart_uv21,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.collect_uv end ),0) as avg_collect_uv21,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.num_gmv end ),0) as avg_num_gmv21,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.amt_gmv end ),0) as avg_amt_gmv21,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.qty_gmv end ),0) as avg_qty_gmv21,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.unum_gmv end ),0) as avg_unum_gmv21,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.amt_alipay end ),0) as avg_amt_alipay21,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.num_alipay end ),0) as avg_num_alipay21,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.qty_alipay end ),0) as avg_qty_alipay21,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.unum_alipay end ),0) as avg_unum_alipay21,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.ztc_pv_ipv end ),0) as avg_ztc_pv_ipv21,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.tbk_pv_ipv end ),0) as avg_tbk_pv_ipv21,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.ss_pv_ipv end ),0) as avg_ss_pv_ipv21,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.jhs_pv_ipv end ),0) as avg_jhs_pv_ipv21,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.ztc_pv_uv end ),0) as avg_ztc_pv_uv21,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.tbk_pv_uv end ),0) as avg_tbk_pv_uv21,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.ss_pv_uv end ),0) as avg_ss_pv_uv21,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.jhs_pv_uv end ),0) as avg_jhs_pv_uv21,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.num_alipay_njhs end ),0) as avg_num_alipay_njhs21,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.amt_alipay_njhs end ),0) as avg_amt_alipay_njhs21,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.qty_alipay_njhs end ),0) as avg_qty_alipay_njhs21,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.unum_alipay_njhs end ),0) as avg_unum_alipay_njhs21,
COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.pv_ipv end ),0) as stddev_pv_uv21,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.pv_uv end ),0) as stddev_cart_ipv21,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.cart_ipv end ),0) as stddev_cart_uv21,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.cart_uv end ),0) as stddev_collect_uv21,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.collect_uv end ),0) as stddev_num_gmv21,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.num_gmv end ),0) as stddev_amt_gmv21,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.amt_gmv end ),0) as stddev_qty_gmv21,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.qty_gmv end ),0) as stddev_unum_gmv21,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.unum_gmv end ),0) as stddev_amt_alipay21,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.amt_alipay end ),0) as stddev_num_alipay21,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.num_alipay end ),0) as stddev_qty_alipay21,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.qty_alipay end ),0) as stddev_unum_alipay21,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.unum_alipay end ),0) as stddev_ztc_pv_ipv21,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.ztc_pv_ipv end ),0) as stddev_tbk_pv_ipv21,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.tbk_pv_ipv end ),0) as stddev_ss_pv_ipv21,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.ss_pv_ipv end ),0) as stddev_jhs_pv_ipv21,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.jhs_pv_ipv end ),0) as stddev_ztc_pv_uv21,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.ztc_pv_uv end ),0) as stddev_tbk_pv_uv21,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.tbk_pv_uv end ),0) as stddev_ss_pv_uv21,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.ss_pv_uv end ),0) as stddev_jhs_pv_uv21,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.jhs_pv_uv end ),0) as stddev_num_alipay_njhs21,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.num_alipay_njhs end ),0) as stddev_amt_alipay_njhs21,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.amt_alipay_njhs end ),0) as stddev_qty_alipay_njhs21,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,21) then b.qty_alipay_njhs end ),0) as stddev_unum_alipay_njhs21,

--/*28*/
COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.pv_ipv end ),0) as sum_pv_ipv28,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.pv_uv end ),0) as sum_pv_uv28,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.cart_ipv end ),0) as sum_cart_ipv28,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.cart_uv end ),0) as sum_cart_uv28,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.collect_uv end ),0) as sum_collect_uv28,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.num_gmv end ),0) as sum_num_gmv28,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.amt_gmv end ),0) as sum_amt_gmv28,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.qty_gmv end ),0) as sum_qty_gmv28,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.unum_gmv end ),0) as sum_unum_gmv28,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.amt_alipay end ),0) as sum_amt_alipay28,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.num_alipay end ),0) as sum_num_alipay28,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.qty_alipay end ),0) as sum_qty_alipay28,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.unum_alipay end ),0) as sum_unum_alipay28,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.ztc_pv_ipv end ),0) as sum_ztc_pv_ipv28,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.tbk_pv_ipv end ),0) as sum_tbk_pv_ipv28,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.ss_pv_ipv end ),0) as sum_ss_pv_ipv28,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.jhs_pv_ipv end ),0) as sum_jhs_pv_ipv28,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.ztc_pv_uv end ),0) as sum_ztc_pv_uv28,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.tbk_pv_uv end ),0) as sum_tbk_pv_uv28,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.ss_pv_uv end ),0) as sum_ss_pv_uv28,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.jhs_pv_uv end ),0) as sum_jhs_pv_uv28,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.num_alipay_njhs end ),0) as sum_num_alipay_njhs28,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.amt_alipay_njhs end ),0) as sum_amt_alipay_njhs28,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.qty_alipay_njhs end ),0) as sum_qty_alipay_njhs28,COALESCE(sum(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.unum_alipay_njhs end ),0) as sum_unum_alipay_njhs28,
COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.pv_ipv end ),0) as avg_pv_ipv28,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.pv_uv end ),0) as avg_pv_uv28,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.cart_ipv end ),0) as avg_cart_ipv28,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.cart_uv end ),0) as avg_cart_uv28,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.collect_uv end ),0) as avg_collect_uv28,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.num_gmv end ),0) as avg_num_gmv28,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.amt_gmv end ),0) as avg_amt_gmv28,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.qty_gmv end ),0) as avg_qty_gmv28,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.unum_gmv end ),0) as avg_unum_gmv28,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.amt_alipay end ),0) as avg_amt_alipay28,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.num_alipay end ),0) as avg_num_alipay28,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.qty_alipay end ),0) as avg_qty_alipay28,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.unum_alipay end ),0) as avg_unum_alipay28,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.ztc_pv_ipv end ),0) as avg_ztc_pv_ipv28,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.tbk_pv_ipv end ),0) as avg_tbk_pv_ipv28,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.ss_pv_ipv end ),0) as avg_ss_pv_ipv28,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.jhs_pv_ipv end ),0) as avg_jhs_pv_ipv28,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.ztc_pv_uv end ),0) as avg_ztc_pv_uv28,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.tbk_pv_uv end ),0) as avg_tbk_pv_uv28,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.ss_pv_uv end ),0) as avg_ss_pv_uv28,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.jhs_pv_uv end ),0) as avg_jhs_pv_uv28,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.num_alipay_njhs end ),0) as avg_num_alipay_njhs28,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.amt_alipay_njhs end ),0) as avg_amt_alipay_njhs28,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.qty_alipay_njhs end ),0) as avg_qty_alipay_njhs28,COALESCE(avg(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.unum_alipay_njhs end ),0) as avg_unum_alipay_njhs28,
COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.pv_ipv end ),0) as stddev_pv_uv28,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.pv_uv end ),0) as stddev_cart_ipv28,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.cart_ipv end ),0) as stddev_cart_uv28,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.cart_uv end ),0) as stddev_collect_uv28,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.collect_uv end ),0) as stddev_num_gmv28,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.num_gmv end ),0) as stddev_amt_gmv28,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.amt_gmv end ),0) as stddev_qty_gmv28,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.qty_gmv end ),0) as stddev_unum_gmv28,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.unum_gmv end ),0) as stddev_amt_alipay28,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.amt_alipay end ),0) as stddev_num_alipay28,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.num_alipay end ),0) as stddev_qty_alipay28,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.qty_alipay end ),0) as stddev_unum_alipay28,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.unum_alipay end ),0) as stddev_ztc_pv_ipv28,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.ztc_pv_ipv end ),0) as stddev_tbk_pv_ipv28,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.tbk_pv_ipv end ),0) as stddev_ss_pv_ipv28,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.ss_pv_ipv end ),0) as stddev_jhs_pv_ipv28,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.jhs_pv_ipv end ),0) as stddev_ztc_pv_uv28,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.ztc_pv_uv end ),0) as stddev_tbk_pv_uv28,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.tbk_pv_uv end ),0) as stddev_ss_pv_uv28,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.ss_pv_uv end ),0) as stddev_jhs_pv_uv28,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.jhs_pv_uv end ),0) as stddev_num_alipay_njhs28,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.num_alipay_njhs end ),0) as stddev_amt_alipay_njhs28,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.amt_alipay_njhs end ),0) as stddev_qty_alipay_njhs28,COALESCE(stddev(case when b.date_dt >= date_add(a.date_dt,1) and b.date_dt <= date_add(a.date_dt,28) then b.qty_alipay_njhs end ),0) as stddev_unum_alipay_njhs28
from 
(select * from cainiao.date_dt_item where date_dt > '20150101' )a 
left join (select * from cainiao.date_dt_item where date_dt > '20150101') b on a.item_id = b.item_id
group by a.item_id,a.date_dt,COALESCE(a.cate_id,0),COALESCE(a.cate_level_id,0),COALESCE(a.brand_id,0),COALESCE(a.supplier_id,0),COALESCE(a.pv_ipv,0),COALESCE(a.pv_uv,0),COALESCE(a.cart_ipv,0),COALESCE(a.cart_uv,0),COALESCE(a.collect_uv,0),COALESCE(a.num_gmv,0),COALESCE(a.amt_gmv,0),COALESCE(a.qty_gmv,0),COALESCE(a.unum_gmv,0),COALESCE(a.amt_alipay,0),COALESCE(a.num_alipay,0),COALESCE(a.qty_alipay,0),COALESCE(a.unum_alipay,0),COALESCE(a.ztc_pv_ipv,0),COALESCE(a.tbk_pv_ipv,0),COALESCE(a.ss_pv_ipv,0),COALESCE(a.jhs_pv_ipv,0),COALESCE(a.ztc_pv_uv,0),COALESCE(a.tbk_pv_uv,0),COALESCE(a.ss_pv_uv,0),COALESCE(a.jhs_pv_uv,0),COALESCE(a.num_alipay_njhs,0),COALESCE(a.amt_alipay_njhs,0),COALESCE(a.qty_alipay_njhs,0),COALESCE(a.unum_alipay_njhs,0),
--/*组合特征*/
COALESCE(a.unum_alipay/a.pv_uv,0),COALESCE(a.num_alipay/a.num_gmv,0),
COALESCE(a.amt_alipay/a.amt_gmv, 0),
COALESCE(a.amt_alipay/a.qty_alipay, 0),COALESCE(a.amt_alipay/a.num_alipay, 0),
COALESCE(a.unum_alipay_njhs/a.pv_uv, 0),COALESCE(a.qty_alipay_njhs/a.qty_alipay, 0) ,COALESCE(a.amt_alipay_njhs/a.amt_gmv, 0),COALESCE(a.amt_alipay_njhs/a.num_alipay_njhs, 0),(datediff('2015/12/28',a.date_dt)-1);












成交比率：成交人次／流量UV ；成功成交率：成交笔数／拍下笔数
商品折扣率：成交金额 / 拍下金额；

单件成交价格：成交金额／成交件数；单笔成交价格：成交金额／成交笔数

非聚划支付转化率：非聚划算支付人次／流量UV

非聚划售出占比：非聚划算支付件数／成交件数

非聚划支付占比：非聚划算支付金额／成交金额

单笔价值：非聚划算支付金额／非聚划算支付笔数




FROM (
SELECT a.* FROM(
SELECT a.*,FLOOR((date_dtDIFF('2015/12/28',date_dt)-1)/14) AS watch FROM(
SELECT * FROM item_feature )a)a WHERE watch=0)a GROUP BY item_id
)a 

SELECT item_id,AVG(pv_ipv)AS pv_ipv_1,AVG(pv_uv) AS pv_uv_1,AVG(cart_ipv)AS cart_ipv_1,AVG(cart_uv)AS cart_uv_1,
AVG(collect_uv)AS collect_uv_1,AVG(num_gmv)AS num_gmv_1,AVG(amt_gmv)AS amt_gmv_1,AVG(qty_gmv)AS qty_gmv_1,
AVG(unum_gmv)AS unum_gmv_1,AVG(amt_alipay)AS amt_alipay_1,AVG(num_alipay)AS num_alipay_1,AVG(qty_alipay)AS qty_alipay_1,
AVG(unum_alipay)AS unum_alipay_1,AVG(ztc_pv_ipv)AS ztc_pv_ipv_1,AVG(tbk_pv_ipv)AS tbk_pv_ipv_1,AVG(ss_pv_ipv)AS ss_pv_ipv_1,
AVG(jhs_pv_ipv)AS jhs_pv_ipv_1,AVG(ztc_pv_uv)AS ztc_pv_uv_1,AVG(tbk_pv_uv)AS tbk_pv_uv_1,AVG(ss_pv_uv)AS ss_pv_uv_1,
AVG(jhs_pv_uv)AS jhs_pv_uv_1,AVG(num_alipay_njhs)AS num_alipay_njhs_1,AVG(amt_alipay_njhs)AS amt_alipay_njhs_1,
AVG(qty_alipay_njhs)AS qty_alipay_njhs_1,AVG(unum_alipay_njhs)AS unum_alipay_njhs_1,
SUM(pv_ipv)AS pv_ipv_sum_1,SUM(pv_uv) AS pv_uv_sum_1,SUM(cart_ipv)AS cart_ipv_sum_1,SUM(cart_uv)AS cart_uv_sum_1,
SUM(collect_uv)AS collect_uv_sum_1,SUM(num_gmv)AS num_gmv_sum_1,SUM(amt_gmv)AS amt_gmv_sum_1,SUM(qty_gmv)AS qty_gmv_sum_1,
SUM(unum_gmv)AS unum_gmv_sum_1,SUM(amt_alipay)AS amt_alipay_sum_1,SUM(num_alipay)AS num_alipay_sum_1,SUM(qty_alipay)AS qty_alipay_sum_1,
SUM(unum_alipay)AS unum_alipay_sum_1,SUM(ztc_pv_ipv)AS ztc_pv_ipv_sum_1,SUM(tbk_pv_ipv)AS tbk_pv_ipv_sum_1,SUM(ss_pv_ipv)AS ss_pv_ipv_sum_1,
SUM(jhs_pv_ipv)AS jhs_pv_ipv_sum_1,SUM(ztc_pv_uv)AS ztc_pv_uv_sum_1,SUM(tbk_pv_uv)AS tbk_pv_uv_sum_1,SUM(ss_pv_uv)AS ss_pv_uv_sum_1,
SUM(jhs_pv_uv)AS jhs_pv_uv_sum_1,SUM(num_alipay_njhs)AS num_alipay_njhs_sum_1,SUM(amt_alipay_njhs)AS amt_alipay_njhs_sum_1,
SUM(qty_alipay_njhs)AS qty_alipay_njhs_sum_1,SUM(unum_alipay_njhs)AS unum_alipay_njhs_sum_1
FROM item_feature
where ,


select count(*)
from item_feature
where date_dt = '2015-10-05'













CREATE TABLE `yuanyuan`.`item_feature`( `date_dt` date_dt, `item_id` BIGINT, `cate_id` BIGINT, `cate_level_id` BIGINT, `brand_id` BIGINT, `supplier_id` BIGINT, `pv_ipv` BIGINT, `pv_uv` BIGINT, `cart_ipv` BIGINT, `cart_uv` BIGINT, `collect_uv` BIGINT, `num_gmv` BIGINT, `amt_gmv` DOUBLE, `qty_gmv` BIGINT, `unum_gmv` BIGINT, `amt_alipay` DOUBLE, `num_alipay` BIGINT, `qty_alipay` BIGINT, `unum_alipay` BIGINT, `ztc_pv_ipv` BIGINT, `tbk_pv_ipv` BIGINT, `ss_pv_ipv` BIGINT, `jhs_pv_ipv` BIGINT, `ztc_pv_uv` BIGINT, `tbk_pv_uv` BIGINT, `ss_pv_uv` BIGINT, `jhs_pv_uv` BIGINT, `num_alipay_njhs` BIGINT, `amt_alipay_njhs` DOUBLE, `qty_alipay_njhs` BIGINT, `unum_alipay_njhs` BIGINT ) ENGINE=MYISAM;
CREATE TABLE `cainiao`.`item_store_feature`( `date_dt` date_dt, `item_id` BIGINT, `store_code` BIGINT, `cate_id` BIGINT, `cate_level_id` BIGINT, `brand_id` BIGINT, `supplier_id` BIGINT, `pv_ipv` BIGINT, `pv_uv` BIGINT, `cart_ipv` BIGINT, `cart_uv` BIGINT, `collect_uv` BIGINT, `num_gmv` BIGINT, `amt_gmv` DOUBLE, `qty_gmv` BIGINT, `unum_gmv` BIGINT, `amt_alipay` DOUBLE, `num_alipay` BIGINT, `qty_alipay` BIGINT, `unum_alipay` BIGINT, `ztc_pv_ipv` BIGINT, `tbk_pv_ipv` BIGINT, `ss_pv_ipv` BIGINT, `jhs_pv_ipv` BIGINT, `ztc_pv_uv` BIGINT, `tbk_pv_uv` BIGINT, `ss_pv_uv` BIGINT, `jhs_pv_uv` BIGINT, `num_alipay_njhs` BIGINT, `amt_alipay_njhs` DOUBLE, `qty_alipay_njhs` BIGINT, `unum_alipay_njhs` BIGINT ) ENGINE=MYISAM;
USE cainiao;

CREATE TABLE `yuanyuan`.`item_feature`( `date` DATE, `item_id` BIGINT, `cate_id` BIGINT, `cate_level_id` BIGINT, `brand_id` BIGINT, `supplier_id` BIGINT, `pv_ipv` BIGINT, `pv_uv` BIGINT, `cart_ipv` BIGINT, `cart_uv` BIGINT, `collect_uv` BIGINT, `num_gmv` BIGINT, `amt_gmv` DOUBLE, `qty_gmv` BIGINT, `unum_gmv` BIGINT, `amt_alipay` DOUBLE, `num_alipay` BIGINT, `qty_alipay` BIGINT, `unum_alipay` BIGINT, `ztc_pv_ipv` BIGINT, `tbk_pv_ipv` BIGINT, `ss_pv_ipv` BIGINT, `jhs_pv_ipv` BIGINT, `ztc_pv_uv` BIGINT, `tbk_pv_uv` BIGINT, `ss_pv_uv` BIGINT, `jhs_pv_uv` BIGINT, `num_alipay_njhs` BIGINT, `amt_alipay_njhs` DOUBLE, `qty_alipay_njhs` BIGINT, `unum_alipay_njhs` BIGINT ) ENGINE=MYISAM;



--/*导入数据2*/
LOAD DATA LOCAL INFILE '/root/item_feature2.csv'
IGNORE INTO TABLE item_feature
FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '' ESCAPED BY ''
LINES TERMINATED BY '\n';


drop table if exists date_dt_item;
create table date_dt_item as 
select distinct b.date,b.item_id,COALESCE(a.cate_id,0) cate_id,COALESCE(a.cate_level_id,0) cate_level_id,COALESCE(a.brand_id,0) brand_id,COALESCE(a.supplier_id,0) supplier_id,COALESCE(a.pv_ipv,0) pv_ipv,COALESCE(a.pv_uv,0) pv_uv,COALESCE(a.cart_ipv,0) cart_ipv,COALESCE(a.cart_uv,0) cart_uv,COALESCE(a.collect_uv,0) collect_uv,COALESCE(a.num_gmv,0) num_gmv,COALESCE(a.amt_gmv,0) amt_gmv,COALESCE(a.qty_gmv,0) qty_gmv,COALESCE(a.unum_gmv,0) unum_gmv,COALESCE(a.amt_alipay,0) amt_alipay,COALESCE(a.num_alipay,0) num_alipay,COALESCE(a.qty_alipay,0) qty_alipay,COALESCE(a.unum_alipay,0) unum_alipay,COALESCE(a.ztc_pv_ipv,0) ztc_pv_ipv,COALESCE(a.tbk_pv_ipv,0) tbk_pv_ipv,COALESCE(a.ss_pv_ipv,0) ss_pv_ipv,COALESCE(a.jhs_pv_ipv,0) jhs_pv_ipv,COALESCE(a.ztc_pv_uv,0) ztc_pv_uv,COALESCE(a.tbk_pv_uv,0) tbk_pv_uv,COALESCE(a.ss_pv_uv,0) ss_pv_uv,COALESCE(a.jhs_pv_uv,0) jhs_pv_uv,COALESCE(a.num_alipay_njhs,0) num_alipay_njhs,COALESCE(a.amt_alipay_njhs,0) amt_alipay_njhs,COALESCE(a.qty_alipay_njhs,0) qty_alipay_njhs,COALESCE(a.unum_alipay_njhs,0) unum_alipay_njhs
  from
    (select a.date,b.item_id
    from (select distinct date from item_feature) a 
    join (select distinct item_id from item_feature
    ) b on 1=1
    group by a.date,b.item_id
    )b 
left join (select * from item_feature) a on a.item_id = b.item_id and a.date = b.date;

/*全国加入一列*/
alter table train_all add column store_code varchar(20) not null after watch;
alter table test_all add column store_code varchar(20) not null after watch;
/*修改为all*/
UPDATE train_all SET store_code = 'all' WHERE store_code = ' ';
UPDATE test_all SET store_code = 'all' WHERE store_code = ' ';

/*导出数据为csv*/
select *
INTO OUTFILE '/Users/train_all.csv'
FIELDS TERMINATED BY ','
OPTIONALLY ENCLOSED BY '\"'
LINES TERMINATED BY '\n'
FROM train_all
WHERE item_id is not null
ORDER BY 1 DESC;

select *
from test_fencang
into outfile '/Applications/dev/tmp/test_fencang.csv'
FIELDS TERMINATED BY ','
OPTIONALLY ENCLOSED BY '\"'
LINES TERMINATED BY '\n'
;

select *
from train_all
into outfile '/Applications/dev/tmp/train_all.csv'
FIELDS TERMINATED BY ','
OPTIONALLY ENCLOSED BY '"'
LINES TERMINATED BY '\r\n'
;